<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<!-- namespace: 해당 mapper파일의 고유한 별칭 -->
<mapper namespace="memberMapper">
	
	<resultMap type="Member" id="memberResult">
		<result column="USER_NO" property="userNo"/>
		<result column="USER_ID" property="userId"/>
		<result column="USER_PWD" property="userPwd"/>
		<result column="USER_NAME" property="userName"/>
		<result column="GENDER" property="gender"/>
		<result column="NICKNAME" property="nickname"/>
		<result column="BIRTH" property="birth"/>
		<result column="ENROLL_DATE" property="enrollDate"/>
		<result column="MODIFY_DATE" property="modifyDate"/>
		<result column="INTRODUCE" property="introduce"/>
		<result column="PROFILE_IMG" property="profileImg"/>
		<result column="POINT" property="point"/>
		<result column="STATUS" property="status"/>
		<result column="ADMIN" property="admin"/>
	</resultMap>
	
	<!-- 로그인 쿼리문 -->
	<select id="loginMember" resultMap="memberResult">
		SELECT user_no,
				user_id,
				user_pwd,
				user_name,
				gender,
				nickname,
				phone,
				birth,
				enroll_date,
				modify_date,
				introduce,
				profile_img,
				point,
				status, 
				admin
				FROM member
				where user_id = #{userId}
				and user_pwd = #{userPwd}
				and status = 'Y'
	</select>
	
	<!-- 아이디중복체크 -->
	<select id="idCheck" resultType="_int">
		SELECT COUNT(*)
		  FROM MEMBER
		 WHERE USER_ID = #{checkId}
	</select>
	
	<!-- 회원가입 -->
	<insert id="insertMember">
		INSERT INTO MEMBER(
		user_no,
		   USER_ID,
		   USER_PWD,
			nickname
		)
		VALUES(
			NEXTVAL('SEQ_UNO'),
		   #{userId},
		   #{userPwd},
		   #{nickname}
		)
	</insert>
	
	<!-- 회원정보 수정 -->
	<update id="updateMember">
		UPDATE MEMBER
		   SET USER_NAME = #{nickname},
		       profileImg = #{profileImg},
		       introduce = #{introduce},
		       MODIFY_DATE = SYSDATE
		WHERE USER_ID = #{userId}
	</update>
	
	<!-- 회원 탈퇴 -->
	<update id="deleteMember">
		UPDATE MEMBER
		   SET STATUS = 'N'
		 WHERE USER_ID = #{userId}
	</update>
	
	<!-- 포인트 업데이트 -->
	<update id="updatePoint">
		UPDATE MEMBER
			SET point = #{point}
		WHERE USER_NO = #{userNo}
	</update>
	
	<!-- cno에 참여중인 맴버 -->
	<select id="participatedMemberList" resultMap="memberResult">
		SELECT M.USER_NO,
			   NICKNAME,
			   INTRODUCE,
			   PROFILE_IMG
		FROM MEMBER M 
		JOIN REQUEST R USING (USER_NO)
		WHERE R.STATUS = 'Y'
			AND R.CLUB_NO = #{cno}
		ORDER BY CREATE_DATE ASC;
	</select>
</mapper>