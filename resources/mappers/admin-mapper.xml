<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace: 해당 mapper파일의 고유한 별칭 -->
<mapper namespace="adminMapper">
	<resultMap type="Club" id="clubResult">
		<result column="CLUB_NO" property="clubNo" />
		<result column="USER_NO" property="userNo" />
		<result column="CLUB_TITLE" property="clubTitle" />
		<result column="CLUB_TYPE" property="clubType" />
		<result column="CLUB_CONTENT" property="clubContent" />
		<result column="ADDRESS" property="address" />
		<result column="ADDRESS_DETAIL" property="addressDetail" />
		<result column="EVENT_DATE" property="eventDate" />
		<result column="COST" property="cost" />
		<result column="COST_INFO" property="costInfo" />
		<result column="TOTAL_POINT" property="totalPoint" />
		<result column="CAPACITY" property="capacity" />
		<result column="ONLINE" property="online" />
		<result column="QUESTION" property="question" />
		<result column="THUMBNAIL_IMG" property="thumbnailImg" />
		<result column="CREATE_DATE" property="createDate" />
		<result column="MODIFY_DATE" property="modifyDate" />
		<result column="STATUS" property="status" />
		<result column="COUNT" property="count" />
		<result column="CATEGORY_NAME1" property="categoryName1" />
		<result column="CATEGORY_NAME2" property="categoryName2" />
	</resultMap>

	<resultMap type="Notice" id="noticeResult">
		<result column="NOTICE_NO" property="noticeNo" />
		<result column="NOTICE_TITLE" property="noticeTitle" />
		<result column="NOTICE_TYPE" property="noticeType" />
		<result column="USER_NO" property="userNo" />
		<result column="NOTICE_CONTENT" property="noticeContent" />
		<result column="COUNT" property="count" />
		<result column="CREATE_DATE" property="createDate" />
		<result column="MODIFY_DATE" property="modifyDate" />
		<result column="STATUS" property="status" />
		 <result column="request_status" property="request_status" />
	</resultMap>

	<resultMap type="Request" id="requestResult">
		<result column="REQUEST_NO" property="requestNo" />
		<result column="USER_NO" property="userNo" />
		<result column="CLUB_NO" property="clubNo" />
		<result column="ANSWER" property="answer" />
		<result column="CREATE_DATE" property="createDate" />
		<result column="STATUS" property="status" />
	</resultMap>

	<resultMap type="Member" id="memberResult">
		<result column="USER_NO" property="userNo" />
		<result column="USER_ID" property="userId" />
		<result column="USER_PWD" property="userPwd" />
		<result column="USER_NAME" property="userName" />
		<result column="GENDER" property="gender" />
		<result column="NICKNAME" property="nickname" />
		<result column="BIRTH" property="birth" />
		<result column="ENROLL_DATE" property="enrollDate" />
		<result column="MODIFY_DATE" property="modifyDate" />
		<result column="INTRODUCE" property="introduce" />
		<result column="PROFILE_IMG" property="profileImg" />
		<result column="POINT" property="point" />
		<result column="STATUS" property="status" />
		<result column="ADMIN" property="admin" />
	</resultMap>

	<update id="increaseCount">
		UPDATE CLUB
		SET COUNT = COUNT + 1
		WHERE
		CLUB_NO = #{cno}
		AND STATUS = 'Y';
	</update>


	<!-- adminClub -->
	<select id="MemberList" resultMap="memberResult">
		SELECT USER_NO,
		NICKNAME,
		INTRODUCE,
		PROFILE_IMG
		FROM public.MEMBER
		JOIN public.REQUEST USING (USER_NO);
	</select>

	<select id="getClubList" resultType="int">
		SELECT COUNT(*)
		FROM CLUB;
	</select>
	
	<!-- 전체 -->
	<select id="selectClublist" resultMap="clubResult">
		SELECT CLUB.CLUB_NO,
			CLUB.USER_NO,
			CLUB_TITLE,
			CLUB_TYPE,
			CLUB_CONTENT,
			ADDRESS,
			ADDRESS_DETAIL,
			EVENT_DATE,
			COST,
			COST_INFO,
			TOTAL_POINT,
			CAPACITY,
			ONLINE,
			QUESTION,
			THUMBNAIL_IMG,
			CLUB.CREATE_DATE,
			CLUB.MODIFY_DATE,
			COUNT,
			CLUB.STATUS,
			NICKNAME,
			category_name1,
			category_name2,
		    REQUEST.STATUS as request_status,
			NICKNAME,
			category_name1,
			category_name2
		    FROM public.CLUB
	    join MEMBER ON CLUB.USER_NO = MEMBER.USER_NO
	    join REQUEST ON CLUB.CLUB_NO = REQUEST.CLUB_NO
	    Order by CLUB.CLUB_NO ${sortType};
	</select>

	<!-- 진행중 -->
	<select id="selectClubProcess" resultMap="clubResult">
		SELECT CLUB.CLUB_NO,
			CLUB.USER_NO,
			CLUB_TITLE,
			CLUB_TYPE,
			CLUB_CONTENT,
			ADDRESS,
			ADDRESS_DETAIL,
			EVENT_DATE,
			COST,
			COST_INFO,
			TOTAL_POINT,
			CAPACITY,
			ONLINE,
			QUESTION,
			THUMBNAIL_IMG,
			CLUB.CREATE_DATE,
			CLUB.MODIFY_DATE,
			COUNT,
	        CLUB.STATUS,
	        REQUEST.STATUS as request_status,
			NICKNAME,
			category_name1,
			category_name2
    FROM public.CLUB
    join MEMBER ON CLUB.USER_NO = MEMBER.USER_NO
    join REQUEST ON CLUB.CLUB_NO = REQUEST.CLUB_NO
    WHERE CLUB.STATUS = 'Y'
    Order by CLUB.CLUB_NO ${sortType};
	</select>

	<!-- 종료됨 -->
	<select id="selectClubEnd" resultMap="clubResult">
		SELECT CLUB.CLUB_NO,
			CLUB.USER_NO,
			CLUB_TITLE,
			CLUB_TYPE,
			CLUB_CONTENT,
			ADDRESS,
			ADDRESS_DETAIL,
			EVENT_DATE,
			COST,
			COST_INFO,
			TOTAL_POINT,
			CAPACITY,
			ONLINE,
			QUESTION,
			THUMBNAIL_IMG,
			CLUB.CREATE_DATE,
			CLUB.MODIFY_DATE,
			COUNT,
	        CLUB.STATUS,
        	REQUEST.STATUS as request_status,
			NICKNAME,
			category_name1,
			category_name2
    FROM public.CLUB
    join MEMBER ON CLUB.USER_NO = MEMBER.USER_NO
    join REQUEST ON CLUB.CLUB_NO = REQUEST.CLUB_NO
    WHERE CLUB.STATUS = 'E'
    Order by CLUB.CLUB_NO ${sortType};
	</select>

	<!-- 미승인 -->
	<select id="selectClubApprove" resultMap="clubResult">
		SELECT CLUB.CLUB_NO,
			CLUB.USER_NO,
			CLUB_TITLE,
			CLUB_TYPE,
			CLUB_CONTENT,
			ADDRESS,
			ADDRESS_DETAIL,
			EVENT_DATE,
			COST,
			COST_INFO,
			TOTAL_POINT,
			CAPACITY,
			ONLINE,
			QUESTION,
			THUMBNAIL_IMG,
			CLUB.CREATE_DATE,
			CLUB.MODIFY_DATE,
			COUNT,
	        CLUB.STATUS,
        	REQUEST.STATUS as request_status,
			NICKNAME,
			category_name1,
			category_name2
		    FROM public.CLUB
	    join MEMBER ON CLUB.USER_NO = MEMBER.USER_NO
	    join REQUEST ON CLUB.CLUB_NO = REQUEST.CLUB_NO
	    WHERE REQUEST.STATUS = 'W'
	    Order by CLUB.CLUB_NO ${sortType};
	</select>
	<!-- -->

	<!-- adminUserlist -->
	<select id="getMemberlist" resultType="int">
		SELECT COUNT(*)
		FROM MEMBER
		WHERE ADMIN = 'N';
	</select>
	
	<!-- 전체 -->
	<select id="MemberAll" resultMap="memberResult">
		SELECT *
		FROM MEMBER
		WHERE ADMIN = 'N'
		Order by USER_NO DESC;
	</select>
	
	<!-- 진행중 -->
	<select id="MemberActive" resultMap="memberResult">
		SELECT *
		FROM MEMBER
		WHERE ADMIN = 'N'
		AND STATUS = 'Y'
		Order by USER_NO DESC;
	</select>
	
	<!-- 종료 -->
	<select id="MemberEnd" resultMap="memberResult">
		SELECT *
		FROM MEMBER
		WHERE ADMIN = 'N'
		AND STATUS = 'N'
		Order by USER_NO DESC;
	</select>

	<!-- adminManager -->
	<select id="getManagerlist" resultType="int">
		SELECT COUNT(*)
		FROM
		MEMBER
		WHERE ADMIN = 'Y';
	</select>
	
	<!-- 전체 -->
	<select id="ManagerAll" resultMap="memberResult">
		SELECT *
		FROM MEMBER
		WHERE ADMIN = 'Y'
		Order by USER_NO DESC;
	</select>
	
	<!-- 진행중 -->
	<select id="ManagerActive" resultMap="memberResult">
		SELECT *
		FROM MEMBER
		WHERE ADMIN = 'Y'
		AND STATUS = 'Y'
		Order by USER_NO DESC;
	</select>
	
	<!-- 종료 -->
	<select id="ManagerEnd" resultMap="memberResult">
		SELECT *
		FROM MEMBER
		WHERE ADMIN = 'Y'
		AND STATUS = 'N'
		Order by USER_NO DESC;
	</select>

	<!-- adminNotice -->
	<select id="getNoticeCount" resultType="int">
		SELECT COUNT(*)
		FROM NOTICE;
	</select>
	
	<!-- 전체 -->
	<select id="getNoticeAll" resultMap="noticeResult">
		SELECT *
		FROM NOTICE N
		JOIN MEMBER USING (USER_NO)
		Order by NOTICE_NO DESC;
	</select>
	
	<!-- 이벤트 -->
	<select id="getNoticeEvent" resultMap="noticeResult">
		SELECT *
		FROM NOTICE N
		JOIN MEMBER USING (USER_NO)
		WHERE NOTICE_TYPE = '이벤트'
		Order by NOTICE_NO DESC;
	</select>
	
	<!-- 공지사항 -->
	<select id="getNoticeBoard" resultMap="noticeResult">
		SELECT *
		FROM NOTICE N
		JOIN MEMBER USING (USER_NO)
		WHERE NOTICE_TYPE = '공지'
		Order by NOTICE_NO DESC;
	</select>
</mapper>